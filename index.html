<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç”¨èªãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ï½œDSæ¤œå®šãƒ»Gæ¤œå®šå¯¾ç­–</title>
<style>
  :root{
    --bg:#0f172a;/*slate-900*/
    --card:#111827ee;/*gray-900*/
    --muted:#94a3b8;/*slate-400*/
    --text:#e5e7eb;/*gray-200*/
    --accent:#22c55e;/*green-500*/
    --accent-2:#60a5fa;/*blue-400*/
    --danger:#ef4444;/*red-500*/
    --warn:#f59e0b;/*amber-500*/
    --ok:#10b981;/*emerald-500*/
    --shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  html,body{height:100%;}
  body{margin:0;background:linear-gradient(120deg,#0b1222,#0f172a 40%,#0b1222);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans JP','Hiragino Kaku Gothic ProN','Meiryo',sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:20px 16px 56px;}
  header{position:sticky;top:0;background:linear-gradient(180deg,rgba(15,23,42,.95),rgba(15,23,42,.85));backdrop-filter:saturate(180%) blur(8px);z-index:10;border-bottom:1px solid rgba(255,255,255,.06)}
  .h-inner{display:flex;gap:12px;align-items:center;justify-content:space-between;max-width:980px;margin:0 auto;padding:14px 16px}
  .title{display:flex;gap:10px;align-items:center;font-weight:700}
  .badge{font-size:12px;padding:4px 8px;border-radius:999px;background:rgba(96,165,250,.15);color:#bfdbfe;border:1px solid rgba(96,165,250,.35)}
  .controls{display:flex;flex-wrap:wrap;gap:8px}
  button,select,input[type="text"]{background:#0b1222;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:10px 12px;border-radius:12px}
  button{cursor:pointer}
  button.primary{background:linear-gradient(180deg,#1f2937,#111827);border-color:rgba(255,255,255,.18)}
  button.ghost{background:transparent;border-color:rgba(255,255,255,.18)}
  button:hover{border-color:rgba(255,255,255,.35)}
  .search{flex:1;min-width:180px}

  .grid{display:grid;grid-template-columns:1fr;gap:16px;margin-top:18px}
  @media(min-width:840px){.grid{grid-template-columns:1.2fr .8fr}}

  .card{background:var(--card);border:1px solid rgba(255,255,255,.06);box-shadow:var(--shadow);border-radius:18px;padding:18px}
  .term-card{min-height:280px;display:flex;flex-direction:column;gap:14px}
  .term{font-size:28px;font-weight:800;letter-spacing:.3px}
  .reading{color:var(--muted);font-size:14px}
  .def{font-size:16px;line-height:1.8}
  .meta{display:flex;flex-wrap:wrap;gap:8px}
  .chip{font-size:12px;border:1px dashed rgba(255,255,255,.18);padding:4px 8px;border-radius:999px;color:#cbd5e1}
  .rel{display:flex;flex-wrap:wrap;gap:8px}
  .rel a{color:#a5b4fc;text-decoration:none;border-bottom:1px dashed rgba(165,180,252,.45)}
  .rel a:hover{filter:brightness(1.2)}

  .actions{display:flex;gap:10px;flex-wrap:wrap}
  .actions button{flex:1}
  .stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
  .stat{background:#0b1222;border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:14px;text-align:center}
  .stat .num{font-weight:800;font-size:22px}
  .stat .lbl{font-size:12px;color:var(--muted)}

  .list{display:grid;gap:10px;max-height:520px;overflow:auto}
  .row{display:grid;grid-template-columns:1fr 2fr;gap:10px;align-items:start;background:#0b1222;border:1px solid rgba(255,255,255,.08);padding:12px;border-radius:12px}
  .row small{color:var(--muted)}

  .muted{color:var(--muted)}
  .hint{font-size:12px;color:#93c5fd}

  dialog{border:none;border-radius:16px;max-width:680px;width:calc(100% - 24px);background:#0b1222;color:var(--text);padding:0;box-shadow:var(--shadow)}
  .dlg-h{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid rgba(255,255,255,.08)}
  .dlg-c{padding:16px;display:grid;gap:12px}
  .dlg-f{display:flex;gap:10px;padding:16px;border-top:1px solid rgba(255,255,255,.08)}
  .fld{display:grid;gap:6px}
  textarea{min-height:96px;background:#0b1222;border:1px solid rgba(255,255,255,.12);color:var(--text);padding:10px;border-radius:12px}
  .kbd{font-family:ui-monospace, SFMono-Regular, Menlo, monospace;background:#0b1222;border:1px solid rgba(255,255,255,.18);padding:2px 6px;border-radius:6px}

  footer{opacity:.7;text-align:center;padding:24px 10px}
</style>
</head>
<body>
  <header>
    <div class="h-inner">
      <div class="title">
        <span style="font-size:20px">ğŸ“š ç”¨èªãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼</span>
        <span class="badge">DSæ¤œå®š / Gæ¤œå®š</span>
      </div>
      <div class="controls">
        <input id="q" class="search" type="text" placeholder="ç”¨èªæ¤œç´¢ (è‹±èª/æ—¥æœ¬èª/èª­ã¿/ã‚¿ã‚°/é–¢é€£èª) / ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: /" />
        <select id="tag">
          <option value="">ã™ã¹ã¦ã®ã‚¿ã‚°</option>
          <option>ML</option>
          <option>çµ±è¨ˆ</option>
          <option>ä¸€èˆ¬</option>
          <option>ãƒ‡ãƒ¼ã‚¿åŸºç›¤</option>
          <option>å€«ç†ãƒ»æ³•å¾‹</option>
        </select>
        <select id="mode">
          <option value="learn">å­¦ç¿’ã‚«ãƒ¼ãƒ‰</option>
          <option value="quiz-def">ã‚¯ã‚¤ã‚º: å®šç¾©â†’ç”¨èª</option>
          <option value="quiz-term">ã‚¯ã‚¤ã‚º: ç”¨èªâ†’å®šç¾©</option>
          <option value="list">ãƒªã‚¹ãƒˆè¡¨ç¤º</option>
        </select>
        <button id="btn-shuffle" class="ghost" title="é †åºã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«">ğŸ”€</button>
        <button id="btn-add" class="primary">ï¼‹ ç”¨èªè¿½åŠ </button>
        <button id="btn-export" class="ghost">â¤´ï¸ æ›¸ãå‡ºã—</button>
        <button id="btn-import" class="ghost">â¤µï¸ å–ã‚Šè¾¼ã¿</button>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <section class="card term-card">
        <div class="meta">
          <span class="chip" id="chip-index">0 / 0</span>
          <span class="chip" id="chip-due">æ¬¡å›: -</span>
          <span class="chip" id="chip-tags"></span>
          <span class="chip" id="chip-box">Box: -</span>
        </div>
        <div>
          <div class="term" id="term">â€”</div>
          <div class="reading" id="reading"></div>
        </div>
        <div class="def" id="def">å·¦ä¸Šã®ãƒ¢ãƒ¼ãƒ‰ã€Œå­¦ç¿’ã‚«ãƒ¼ãƒ‰/ã‚¯ã‚¤ã‚ºã€ã‚’é¸ã³ã€æ¤œç´¢ã‚„ã‚¿ã‚°ã§çµã£ã¦é–‹å§‹ã€‚</div>
        <div class="rel" id="rel"></div>
        <div class="actions">
          <button id="btn-flip">ğŸª„ åè»¢ / ãƒ’ãƒ³ãƒˆ</button>
          <button id="btn-good" style="border-color: rgba(16,185,129,.6)">ğŸ‘ è¦šãˆãŸ</button>
          <button id="btn-bad" style="border-color: rgba(239,68,68,.6)">ğŸ‘ ã¾ã </button>
          <button id="btn-edit" class="ghost">âœ ç·¨é›†</button>
          <button id="btn-del" class="ghost" style="color:#fecaca;border-color: rgba(239,68,68,.45)">ğŸ—‘ å‰Šé™¤</button>
        </div>
      </section>

      <aside class="card">
        <div class="stats">
          <div class="stat"><div class="num" id="st-count">0</div><div class="lbl">ç”¨èªç·æ•°</div></div>
          <div class="stat"><div class="num" id="st-new">0</div><div class="lbl">æ–°è¦</div></div>
          <div class="stat"><div class="num" id="st-learning">0</div><div class="lbl">å­¦ç¿’ä¸­</div></div>
          <div class="stat"><div class="num" id="st-review">0</div><div class="lbl">å¾©ç¿’</div></div>
        </div>
        <hr style="opacity:.15;margin:16px 0">
        <div class="muted" style="display:grid;gap:8px">
          <div>ğŸ“Œ <b>Leitneræ–¹å¼</b>ã§å¾©ç¿’é–“éš”ã‚’è‡ªå‹•èª¿æ•´ï¼ˆBox1: æ˜æ—¥ / Box2: 3æ—¥å¾Œ / Box3: 7æ—¥å¾Œ / Missã§ãƒªã‚»ãƒƒãƒˆï¼‰ã€‚</div>
          <div>âŒ¨ï¸ <span class="kbd">/</span> æ¤œç´¢ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã€<span class="kbd">Space</span> åè»¢ã€<span class="kbd">J/K</span> å‰å¾Œã€<span class="kbd">L</span> è¦šãˆãŸã€<span class="kbd">H</span> ã¾ã ã€‚</div>
          <div>ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã® <b>localStorage</b> ã«ä¿å­˜ã€‚<br>JSONã§ <b>æ›¸ãå‡ºã—/å–ã‚Šè¾¼ã¿</b> å¯ï¼ˆåˆ¥ç«¯æœ«ãƒ»å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯¾ç­–ï¼‰ã€‚</div>
        </div>
      </aside>
    </div>

    <section class="card" id="listSection" style="margin-top:16px;display:none">
      <div class="list" id="list"></div>
    </section>
  </main>

  <footer>
    <small class="muted">Â© ç”¨èªãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ â€” GitHub Pages / Notion åŸ‹ã‚è¾¼ã¿å¯¾å¿œã€‚ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã®ã¿ãƒ»é€šä¿¡ãªã—ã€‚</small>
  </footer>

  <!-- è¿½åŠ /ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
  <dialog id="dlg">
    <div class="dlg-h">
      <div id="dlg-title">ç”¨èªã‚’è¿½åŠ </div>
      <button id="dlg-x" class="ghost">âœ•</button>
    </div>
    <div class="dlg-c">
      <div class="fld"><label>ç”¨èªï¼ˆè‹±èª/æ—¥æœ¬èªï¼‰</label><input id="f-term" type="text" placeholder="ä¾‹: gradient descent / å‹¾é…é™ä¸‹æ³•" /></div>
      <div class="fld"><label>èª­ã¿ï¼ˆä»»æ„ï¼‰</label><input id="f-reading" type="text" placeholder="ä¾‹: ã“ã†ã°ã„ãƒ»ã“ã†ã‹ ã»ã†" /></div>
      <div class="fld"><label>å®šç¾© / ãƒã‚¤ãƒ³ãƒˆ</label><textarea id="f-def" placeholder="åˆå­¦è€…ã«ã‚‚ä¼ã‚ã‚‹ä¸€æ–‡ã€ãã®å¾Œã«è¦ç‚¹ç®‡æ¡æ›¸ããªã©"></textarea></div>
      <div class="fld"><label>ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label><input id="f-tags" type="text" placeholder="ä¾‹: ML, çµ±è¨ˆ" /></div>
      <div class="fld"><label>é–¢é€£èªï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label><input id="f-related" type="text" placeholder="ä¾‹: å­¦ç¿’ç‡, å±€æ‰€è§£, æœ€æ€¥é™ä¸‹æ³•" /></div>
      <div class="fld"><label>åå¯¾èª/æ··åŒèªï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰</label><input id="f-antonyms" type="text" placeholder="ä¾‹: ä¸Šæ˜‡æ³•, hill climbing" /></div>
      <div class="fld"><label>å‡ºå…¸URLï¼ˆä»»æ„ï¼‰</label><input id="f-src" type="text" placeholder="https://â€¦" /></div>
    </div>
    <div class="dlg-f">
      <button id="dlg-save" class="primary">ä¿å­˜</button>
      <button id="dlg-cancel" class="ghost">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
  </dialog>

  <input id="file" type="file" accept="application/json" style="display:none" />

<script>
// ==========================
// ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ« & æ°¸ç¶šåŒ–
// ==========================
const STORE_KEY = 'glossary.v1';
/**
 * term: æ–‡å­—åˆ—ï¼ˆä¸»ã‚­ãƒ¼ï¼‰
 * reading: ã‚ˆã¿
 * def: å®šç¾©
 * tags: ["ML","çµ±è¨ˆ","ä¸€èˆ¬"â€¦]
 * related: [ç”¨èª]
 * antonyms: [ç”¨èª]
 * src: å‚è€ƒURL
 * box: 0|1|2|3 ï¼ˆLeitnerï¼‰
 * due: æ¬¡å›å¾©ç¿’æ—¥æ™‚ï¼ˆmsï¼‰
 * seen: å‡ºé¡Œå›æ•°
 * correct: æ­£ç­”å›æ•°
 */
let DB = [];

function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(DB)); }
function load(){
  try{ DB = JSON.parse(localStorage.getItem(STORE_KEY)||'[]') }catch{ DB=[] }
}

// æ—¢å­˜ã«ç„¡ã‘ã‚Œã°åˆæœŸç”¨èªã‚’æŠ•å…¥
function ensureSeed(){
  if(DB.length>0) return;
  const seed = [
    // â€”â€”â€” MLï¼ˆä»£è¡¨ï¼‰
    G('gradient descent','å‹¾é…é™ä¸‹æ³•','ç›®çš„é–¢æ•°ã®å‹¾é…ã®è² æ–¹å‘ã¸åå¾©çš„ã«ç§»å‹•ã—ã¦æ¥µå°å€¤ã‚’æ¢ç´¢ã™ã‚‹æœ€é©åŒ–æ‰‹æ³•ã€‚å­¦ç¿’ç‡ã®è¨­å®šãŒé‡è¦ã€‚', ['ML'], ['learning rate','å±€æ‰€è§£','æœ€æ€¥é™ä¸‹æ³•'], ['hill climbing'], ''),
    G('stochastic gradient descent (SGD)','ç¢ºç‡çš„å‹¾é…é™ä¸‹æ³•','ãƒ‡ãƒ¼ã‚¿ã®ãƒŸãƒ‹ãƒãƒƒãƒ/å˜ä¸€ã‚µãƒ³ãƒ—ãƒ«ã§è¿‘ä¼¼å‹¾é…ã‚’ç”¨ã„ã¦æ›´æ–°ã™ã‚‹æ‰‹æ³•ã€‚å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ã§é«˜é€Ÿãƒ»ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å­¦ç¿’ã«é©ã™ã‚‹ã€‚', ['ML'], ['mini-batch','momentum','Adam'], ['batch gradient descent'], ''),
    G('learning rate','å­¦ç¿’ç‡','ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ›´æ–°ã®ä¸€å›ã‚ãŸã‚Šã®ã‚¹ãƒ†ãƒƒãƒ—å¹…ã€‚å¤§ãã™ãã‚‹ã¨ç™ºæ•£ï¼Œå°ã•ã™ãã‚‹ã¨åæŸãŒé…ã„ã€‚ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ©ã‚„warmupã§èª¿æ•´ã™ã‚‹ã€‚', ['ML'], ['optimizer','SGD','Adam'], [''], ''),
    G('overfitting','éå­¦ç¿’','è¨“ç·´ãƒ‡ãƒ¼ã‚¿ã«éå‰°é©åˆã—ã¦æ±åŒ–æ€§èƒ½ãŒä½ä¸‹ã™ã‚‹çŠ¶æ…‹ã€‚å¯¾ç­–: äº¤å·®æ¤œè¨¼ãƒ»æ­£å‰‡åŒ–ãƒ»ãƒ‡ãƒ¼ã‚¿æ‹¡å¼µãƒ»æ—©æœŸçµ‚äº†ãªã©ã€‚', ['ML'], ['underfitting','regularization','cross-validation'], [''], ''),
    G('regularization','æ­£å‰‡åŒ–','ãƒ¢ãƒ‡ãƒ«ã®è¤‡é›‘ã•ã«ç½°å‰‡ã‚’èª²ã—ã¦æ±åŒ–ã‚’ä¿ƒã™æ‰‹æ³•ï¼ˆL1/L2, Dropoutç­‰ï¼‰ã€‚', ['ML'], ['L1','L2','dropout'], [''], ''),
    G('Precision / Recall','é©åˆç‡ / å†ç¾ç‡','åˆ†é¡æ€§èƒ½æŒ‡æ¨™ã€‚Precision=äºˆæ¸¬é™½æ€§ã®ã†ã¡æ­£è§£å‰²åˆã€Recall=å®Ÿéš›é™½æ€§ã®ã†ã¡æ¤œå‡ºå‰²åˆã€‚F1ã¯ãã®èª¿å’Œå¹³å‡ã€‚', ['ML','çµ±è¨ˆ'], ['F1','ROC','AUC'], [''], ''),
    G('ROC / AUC','ROCæ›²ç·š / AUC','é–¾å€¤ã‚’å‹•ã‹ã—ãŸéš›ã®TPR-FPRæ›²ç·šã¨ãã®é¢ç©ã€‚ã‚¯ãƒ©ã‚¹ä¸å‡è¡¡ã§æœ‰ç”¨ã€‚', ['ML','çµ±è¨ˆ'], ['precision-recall curve'], [''], ''),
    G('bias-variance tradeoff','ãƒã‚¤ã‚¢ã‚¹ãƒ»ãƒãƒªã‚¢ãƒ³ã‚¹ãƒ»ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•','ãƒ¢ãƒ‡ãƒ«ã®å˜ç´”ã•ç”±æ¥ã®ç³»çµ±èª¤å·®ï¼ˆãƒã‚¤ã‚¢ã‚¹ï¼‰ã¨ãƒ‡ãƒ¼ã‚¿ä¾å­˜ã®æºã‚‰ãï¼ˆãƒãƒªã‚¢ãƒ³ã‚¹ï¼‰ã®ä¸¡ç«‹é–¢ä¿‚ã€‚', ['ML','çµ±è¨ˆ'], ['overfitting','underfitting'], [''], ''),
    G('cross-validation','äº¤å·®æ¤œè¨¼','ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¦å­¦ç¿’/è©•ä¾¡ã‚’ç¹°è¿”ã™æ‰‹æ³•ã€‚k-fold, LOOCVãªã©ã€‚', ['çµ±è¨ˆ','ML'], ['hold-out','nested CV'], [''], ''),
    G('confusion matrix','æ··åŒè¡Œåˆ—','åˆ†é¡çµæœã®TP/FP/FN/TNã®é›†è¨ˆè¡¨ã€‚', ['ML','çµ±è¨ˆ'], ['precision','recall','F1'], [''], ''),
    G('feature scaling','ç‰¹å¾´é‡ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°','æ¨™æº–åŒ–ï¼ˆz-scoreï¼‰ã‚„æ­£è¦åŒ–ï¼ˆ[0,1]ï¼‰ã§å­¦ç¿’å®‰å®šåŒ–ã€‚', ['ML'], ['standardization','normalization'], [''], ''),
    G('principal component analysis (PCA)','ä¸»æˆåˆ†åˆ†æ','åˆ†æ•£æœ€å¤§ã®æ–¹å‘ã«ç›´äº¤åŸºåº•ã‚’æ±‚ã‚æ¬¡å…ƒåœ§ç¸®ã™ã‚‹ç·šå½¢æ‰‹æ³•ã€‚', ['çµ±è¨ˆ','ML'], ['SVD','eigenvalue'], [''], ''),
    G('t-SNE','t-SNE','é«˜æ¬¡å…ƒãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–æ‰‹æ³•ã€‚å±€æ‰€æ§‹é€ ã®ä¿æŒã«å¼·ã„ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«è·é›¢ã¯æ­ªã‚€ã€‚', ['ML'], ['UMAP','PCA'], [''], ''),
    G('UMAP','UMAP','ä½ç›¸çš„æ‰‹æ³•ã«åŸºã¥ãæ¬¡å…ƒå‰Šæ¸›ã€‚t-SNEã‚ˆã‚Šé€Ÿãå¤§è¦æ¨¡å‘ãã€‚', ['ML'], ['t-SNE','PCA'], [''], ''),
    G('loss function','æå¤±é–¢æ•°','äºˆæ¸¬ã¨æ­£è§£ã®ã‚ºãƒ¬ã‚’æ•°å€¤åŒ–ã€‚MSE, Cross-Entropy, Hingeãªã©ã€‚', ['ML'], ['objective'], [''], ''),
    G('activation function','æ´»æ€§åŒ–é–¢æ•°','éç·šå½¢å¤‰æ›ã€‚ReLU, sigmoid, tanh, GELUç­‰ã€‚', ['ML'], ['ReLU','sigmoid','tanh','GELU'], [''], ''),
    G('regularized logistic regression','æ­£å‰‡åŒ–ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°','ãƒ­ã‚¸ã‚¹ãƒ†ã‚£ãƒƒã‚¯å›å¸°ã«L1/L2ç­‰ã®ç½°å‰‡ã‚’åŠ ãˆãŸã‚‚ã®ã€‚', ['çµ±è¨ˆ','ML'], ['lasso','ridge'], [''], ''), 

    // â€”â€”â€” æ·±å±¤å­¦ç¿’
    G('transformer','ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒãƒ¼','è‡ªå·±æ³¨æ„æ©Ÿæ§‹ã‚’ç”¨ã„ãŸä¸¦åˆ—è¨ˆç®—ã«å¼·ã„ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã€‚Encoder/Decoder, Multi-Head Attention, æ®‹å·®æ¥ç¶š, å±¤æ­£è¦åŒ–ãªã©ã§æ§‹æˆã€‚', ['ML'], ['self-attention','positional encoding','LLM'], ['RNN','LSTM'], ''),
    G('self-attention','è‡ªå·±æ³¨æ„','ç³»åˆ—å†…ã®ãƒˆãƒ¼ã‚¯ãƒ³é–“é–¢ä¿‚ã‚’é‡ã¿ã«ã‚ˆã‚Šå‹•çš„ã«è¡¨ç¾ã€‚Q/K/Vã‚’ç”¨ã„ã‚‹ã€‚', ['ML'], ['multi-head attention','transformer'], [''], ''),
    G('fine-tuning','ãƒ•ã‚¡ã‚¤ãƒ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°','äº‹å‰å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’ä¸‹æµã‚¿ã‚¹ã‚¯ã«å†å­¦ç¿’ã•ã›ã‚‹ã€‚', ['ML'], ['LoRA','instruction tuning'], ['from-scratch'], ''),
    G('LoRA','LoRA','ä½ãƒ©ãƒ³ã‚¯åˆ†è§£ã«ã‚ˆã‚Šå¾®èª¿æ•´ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å‰Šæ¸›ã™ã‚‹æ‰‹æ³•ã€‚', ['ML'], ['fine-tuning'], [''], ''),
    G('tokenization','ãƒˆãƒ¼ã‚¯ãƒŠã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³','ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚µãƒ–ãƒ¯ãƒ¼ãƒ‰ç­‰ã«åˆ†å‰²ã€‚BPE, Unigramãªã©ã€‚', ['ML'], ['BPE','sentencepiece'], [''], ''),

    // â€”â€”â€” çµ±è¨ˆï¼ˆåŸºç¤ï¼‰
    G('population / sample','æ¯é›†å›£ / æ¨™æœ¬','æ¯é›†å›£ã‹ã‚‰æŠ½å‡ºã—ãŸéƒ¨åˆ†é›†åˆãŒæ¨™æœ¬ã€‚æ¨æ¸¬çµ±è¨ˆã¯æ¨™æœ¬ã‹ã‚‰æ¯é›†å›£ã®æ€§è³ªã‚’æ¨å®šã™ã‚‹ã€‚', ['çµ±è¨ˆ'], ['sampling'], [''], ''),
    G('central limit theorem','ä¸­å¿ƒæ¥µé™å®šç†','ç‹¬ç«‹åŒåˆ†å¸ƒã®å’Œã¯ååˆ†å¤§ãã‘ã‚Œã°æ­£è¦åˆ†å¸ƒã«è¿‘ã¥ãã€‚', ['çµ±è¨ˆ'], ['law of large numbers'], [''], ''),
    G('confidence interval','ä¿¡é ¼åŒºé–“','æ¯æ•°ã®åŒºé–“æ¨å®šã€‚95%CIãªã©ã€‚', ['çµ±è¨ˆ'], ['p-value'], [''], ''), 
    G('p-value','på€¤','å¸°ç„¡ä»®èª¬ã®ä¸‹ã§ã€è¦³æ¸¬ä»¥ä¸Šã®æ¥µç«¯ãªçµæœãŒå¾—ã‚‰ã‚Œã‚‹ç¢ºç‡ã€‚å°ã•ã„ã»ã©å¸°ç„¡ä»®èª¬ã«åã™ã‚‹è¨¼æ‹ ãŒå¼·ã„ã€‚', ['çµ±è¨ˆ'], ['hypothesis testing'], [''], ''),
    G('t-test / ANOVA','tæ¤œå®š / åˆ†æ•£åˆ†æ','å¹³å‡å·®ã®æœ‰æ„æ€§æ¤œå®šã€‚å¯¾å¿œã‚ã‚Š/ãªã—ã€1è¦å› /2è¦å› ãªã©ã€‚', ['çµ±è¨ˆ'], ['effect size','post-hoc'], [''], ''),
    G('chi-square test','ã‚«ã‚¤äºŒä¹—æ¤œå®š','ã‚«ãƒ†ã‚´ãƒªãƒ¼ãƒ‡ãƒ¼ã‚¿ã®ç‹¬ç«‹æ€§ãƒ»é©åˆåº¦ã®æ¤œå®šã€‚', ['çµ±è¨ˆ'], ['Fisher exact test'], [''], ''),
    G('bayes theorem','ãƒ™ã‚¤ã‚ºã®å®šç†','äº‹å‰ç¢ºç‡ã¨å°¤åº¦ã‹ã‚‰äº‹å¾Œç¢ºç‡ã‚’å¾—ã‚‹ã€‚', ['çµ±è¨ˆ'], ['naive bayes','MAP','MLE'], [''], ''),
    G('MLE / MAP','æœ€å°¤æ¨å®š / äº‹å¾Œç¢ºç‡æœ€å¤§åŒ–','ãƒ‡ãƒ¼ã‚¿å°¤åº¦ã‚’æœ€å¤§åŒ–ï¼ˆMLEï¼‰/ äº‹å‰ã‚’æ›ã‘åˆã‚ã›ã¦æœ€å¤§åŒ–ï¼ˆMAPï¼‰ã€‚', ['çµ±è¨ˆ'], ['bayes'], [''], ''),

    // â€”â€”â€” è©•ä¾¡ãƒ»é‹ç”¨
    G('train / validation / test','å­¦ç¿’/æ¤œè¨¼/ãƒ†ã‚¹ãƒˆ','ãƒ¢ãƒ‡ãƒ«æ§‹ç¯‰ã§ã®ãƒ‡ãƒ¼ã‚¿åˆ†å‰²ã®åŸºæœ¬ã€‚', ['ML'], ['cross-validation','hold-out'], [''], ''), 
    G('data leakage','ãƒ‡ãƒ¼ã‚¿ãƒªãƒ¼ã‚¯','æœ¬æ¥æœªçŸ¥ã§ã‚ã‚‹ã¹ãæƒ…å ±ãŒå­¦ç¿’ã«æ··å…¥ã—ã¦éå¤§è©•ä¾¡ã¨ãªã‚‹å•é¡Œã€‚', ['ML'], ['target leakage'], [''], ''),
    G('drift','ãƒ‰ãƒªãƒ•ãƒˆ','ãƒ‡ãƒ¼ã‚¿åˆ†å¸ƒã‚„é–¢ä¿‚ã®çµŒæ™‚å¤‰åŒ–ã€‚ãƒ‡ãƒ¼ã‚¿/æ¦‚å¿µãƒ‰ãƒªãƒ•ãƒˆã€‚', ['ML'], ['monitoring','MLOps'], [''], ''),
    G('MLOps','MLOps','MLã®ç¶™ç¶šçš„ãªå­¦ç¿’ãƒ»è©•ä¾¡ãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ»ç›£è¦–ã‚’è¡Œã†å®Ÿè·µã€‚', ['ML','ãƒ‡ãƒ¼ã‚¿åŸºç›¤'], ['CI/CD','feature store','model registry'], [''], ''),

    // â€”â€”â€” ä¸€èˆ¬ãƒ»éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ã‚‚
    G('API','API','ã‚¢ãƒ—ãƒªåŒå£«ãŒæ©Ÿèƒ½ã‚„ãƒ‡ãƒ¼ã‚¿ã‚’ã‚„ã‚Šå–ã‚Šã™ã‚‹ãŸã‚ã®çª“å£ã€‚', ['ä¸€èˆ¬','ãƒ‡ãƒ¼ã‚¿åŸºç›¤'], ['REST','GraphQL'], [''], ''),
    G('ETL / ELT','ETL / ELT','æŠ½å‡ºãƒ»å¤‰æ›ãƒ»ãƒ­ãƒ¼ãƒ‰ï¼ˆã¾ãŸã¯ãƒ­ãƒ¼ãƒ‰å¾Œã«å¤‰æ›ï¼‰ã€‚', ['ãƒ‡ãƒ¼ã‚¿åŸºç›¤'], ['data pipeline','ingestion'], [''], ''),
    G('schema','ã‚¹ã‚­ãƒ¼ãƒ','ãƒ‡ãƒ¼ã‚¿ã®æ§‹é€ ï¼ˆåˆ—åã€å‹ã€åˆ¶ç´„ãªã©ï¼‰ã®è¨­è¨ˆæƒ…å ±ã€‚', ['ãƒ‡ãƒ¼ã‚¿åŸºç›¤'], ['data model'], [''], ''),
    G('SQL','SQL','é–¢ä¿‚ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œè¨€èªã€‚SELECT/WHERE/GROUP BY/JOINãªã©ã€‚', ['ä¸€èˆ¬','ãƒ‡ãƒ¼ã‚¿åŸºç›¤'], ['NoSQL'], [''], ''),
    G('vector database','ãƒ™ã‚¯ãƒˆãƒ«DB','é«˜æ¬¡å…ƒãƒ™ã‚¯ãƒˆãƒ«ã®è¿‘å‚æ¢ç´¢ã«ç‰¹åŒ–ã—ãŸDBã€‚ANNç´¢å¼•ï¼ˆHNSW, IVFç­‰ï¼‰ã‚’ç”¨ã„ã‚‹ã€‚', ['ãƒ‡ãƒ¼ã‚¿åŸºç›¤','ML'], ['RAG','embedding'], [''], ''),

    // â€”â€”â€” å€«ç†ãƒ»æ³•å¾‹
    G('GDPR','GDPR','EUä¸€èˆ¬ãƒ‡ãƒ¼ã‚¿ä¿è­·è¦å‰‡ã€‚å€‹äººãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†ã«é–¢ã™ã‚‹ãƒ«ãƒ¼ãƒ«ã€‚', ['å€«ç†ãƒ»æ³•å¾‹'], ['å€‹äººæƒ…å ±ä¿è­·'], [''], ''),
    G('privacy by design','ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ»ãƒã‚¤ãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³','è¨­è¨ˆæ®µéšã‹ã‚‰ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­·ã‚’çµ„ã¿è¾¼ã‚€è€ƒãˆæ–¹ã€‚', ['å€«ç†ãƒ»æ³•å¾‹'], ['data minimization'], [''], ''),

    // â€”â€”â€” è©¦é¨“å‘ã‘ã«è¿½åŠ 
    G('confounding','äº¤çµ¡','ä»‹å…¥ã¨ã‚¢ã‚¦ãƒˆã‚«ãƒ ã®é–“ã®ç¬¬3ã®è¦å› ã«ã‚ˆã‚Šå› æœæ¨è«–ãŒæ­ªã‚€ã“ã¨ã€‚', ['çµ±è¨ˆ'], ['causal inference','RCT','å‚¾å‘ã‚¹ã‚³ã‚¢'], [''], ''),
    G('propensity score','å‚¾å‘ã‚¹ã‚³ã‚¢','å…±å¤‰é‡ã‹ã‚‰ä»‹å…¥ã‚’å—ã‘ã‚‹ç¢ºç‡ã‚’æ¨å®šã—ãƒãƒ©ãƒ³ã‚¹å–ã‚Šã«ç”¨ã„ã‚‹ã€‚', ['çµ±è¨ˆ'], ['IPW','ãƒãƒƒãƒãƒ³ã‚°'], [''], ''),

    // â€”â€”â€” æŒ‡å®šã®è¿½åŠ ç”¨èª
    G('context engineering','ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°','ç”ŸæˆAIã«å…¥åŠ›ã™ã‚‹å‰æãƒ»ç›®çš„ãƒ»åˆ¶ç´„ãƒ»è©•ä¾¡è»¸ãªã©ã®ã€Œæ–‡è„ˆã€ã‚’è¨­è¨ˆãƒ»æ§‹æˆã—ã€å†ç¾æ€§ã®ã‚ã‚‹å‡ºåŠ›å“è³ªã‚’å¾—ã‚‹æŠ€æ³•ã€‚ã‚¿ã‚¹ã‚¯åˆ†å‰²ã€ãƒ­ãƒ¼ãƒ«ä»˜ä¸ã€å…¥å‡ºåŠ›ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€è©•ä¾¡ãƒ«ãƒ¼ãƒ—ã€å¤–éƒ¨ãƒ„ãƒ¼ãƒ«é€£æºãªã©ã‚’ä½“ç³»åŒ–ã™ã‚‹ã€‚', ['ä¸€èˆ¬','ML'], ['prompt engineering','system design','RAG','è©•ä¾¡æŒ‡æ¨™'], [''], '')
  ];
  // ã•ã‚‰ã«éã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å‘ã‘ã®åŸºç¤èªã‚’å¤šæ•°è¿½åŠ ï¼ˆæŠœç²‹ï¼‰
  const basic = [
    G('latency','ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·','å¿œç­”ã¾ã§ã®é…å»¶æ™‚é–“ã€‚', ['ä¸€èˆ¬'], ['throughput'], [''], ''),
    G('throughput','ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆ','å˜ä½æ™‚é–“ã‚ãŸã‚Šã®å‡¦ç†é‡ã€‚', ['ä¸€èˆ¬'], ['latency'], [''], ''),
    G('scalability','ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£','è² è·å¢—åŠ ã¸ã®æ‹¡å¼µã®ã—ã‚„ã™ã•ã€‚', ['ä¸€èˆ¬'], ['vertical scaling','horizontal scaling'], [''], ''),
    G('A/B test','A/Bãƒ†ã‚¹ãƒˆ','2ç¾¤ã§æ¯”è¼ƒã—åŠ¹æœã‚’æ¤œè¨¼ã™ã‚‹å®Ÿé¨“ã€‚', ['çµ±è¨ˆ','ML'], ['hypothesis testing'], [''], ''),
    G('normalization','æ­£è¦åŒ–','ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã‚„æ­£è¦åˆ†å¸ƒåŒ–ãªã©æ–‡è„ˆä¾å­˜ã®æ„å‘³ã‚’æŒã¤ã€‚', ['ML','çµ±è¨ˆ'], ['standardization'], [''], ''),
    G('standardization','æ¨™æº–åŒ–','å¹³å‡0, åˆ†æ•£1ã¸ã®å¤‰æ›ã€‚', ['çµ±è¨ˆ','ML'], ['z-score'], [''], '')
  ];
  DB = seed.concat(basic).map(x=>({...x, box:0, due:Date.now(), seen:0, correct:0 }));
  save();
}

function G(term, jp, def, tags=[], related=[], antonyms=[], src=''){
  return {term, reading:jp, def, tags, related, antonyms, src};
}

// ==========================
// ã‚¯ã‚¨ãƒª & ã‚­ãƒ¥ãƒ¼
// ==========================
let IDX = 0;               // è¡¨ç¤ºä¸­ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆãƒ“ãƒ¥ãƒ¼ã«å¯¾ã™ã‚‹ï¼‰
let VIEW = [];             // ãƒ•ã‚£ãƒ«ã‚¿å¾Œã®é…åˆ—ã®å‚ç…§ï¼ˆDBã®æµ…ã„ã‚³ãƒ”ãƒ¼ï¼‰
let FLIPPED = false;       // åè»¢çŠ¶æ…‹ï¼ˆã‚¯ã‚¤ã‚ºç”¨ï¼‰

function applyFilter(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  const tag = document.getElementById('tag').value;
  const now = Date.now();
  VIEW = DB.filter(x=>{
    const hitQ = !q || [x.term,x.reading,x.def,(x.tags||[]).join(','),(x.related||[]).join(','),(x.antonyms||[]).join(',')]
      .join('\n').toLowerCase().includes(q);
    const hitT = !tag || (x.tags||[]).includes(tag);
    return hitQ && hitT;
  }).sort((a,b)=> (a.due||0)-(b.due||0)); // æœŸæ—¥ã®è¿‘ã„é †
  if(document.getElementById('mode').value==='list') renderList();
  IDX = 0; render();
}

function shuffle(){
  for(let i=VIEW.length-1;i>0;i--){ const j=(Math.random()* (i+1))|0; [VIEW[i],VIEW[j]]=[VIEW[j],VIEW[i]] }
  IDX = 0; render();
}

// ==========================
// Leitner ç®±åˆ¶å¾¡
// ==========================
function schedule(card, ok){
  if(!card.box) card.box=0;
  if(ok){
    card.box = Math.min(3, (card.box||0)+1);
  }else{
    card.box = 0; // ãƒŸã‚¹ã§ãƒªã‚»ãƒƒãƒˆ
  }
  const days = [0,1,3,7][card.box];
  card.due = Date.now() + days*24*60*60*1000;
  card.seen = (card.seen||0)+1;
  if(ok) card.correct = (card.correct||0)+1;
}

// ==========================
// ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
// ==========================
function render(){
  document.getElementById('st-count').textContent = DB.length;
  document.getElementById('st-new').textContent = DB.filter(x=> (x.box||0)===0).length;
  document.getElementById('st-learning').textContent = DB.filter(x=> (x.box||0)===1).length;
  document.getElementById('st-review').textContent = DB.filter(x=> (x.box||0)>=2).length;

  const mode = document.getElementById('mode').value;
  const listSection = document.getElementById('listSection');
  listSection.style.display = (mode==='list') ? 'block' : 'none';

  if(VIEW.length===0){
    setText('term','â€”'); setText('reading',''); setHTML('def','è©²å½“ã™ã‚‹ç”¨èªãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ•ã‚£ãƒ«ã‚¿ã‚’å¤‰ãˆã‚‹ã‹è¿½åŠ ã—ã¦ãã ã•ã„ã€‚');
    setText('chip-index','0 / 0'); setText('chip-due','æ¬¡å›: -'); setText('chip-tags',''); setText('chip-box','Box: -');
    document.getElementById('rel').innerHTML='';
    return;
  }

  const card = VIEW[Math.max(0, Math.min(IDX, VIEW.length-1))];
  const dueTxt = card.due ? new Date(card.due).toLocaleString('ja-JP') : '-';

  setText('chip-index', `${IDX+1} / ${VIEW.length}`);
  setText('chip-due', `æ¬¡å›: ${dueTxt}`);
  setText('chip-tags', (card.tags||[]).map(t=>`#${t}`).join(' '));
  setText('chip-box', `Box: ${card.box||0}`);

  const modeIsQuizDef = (mode==='quiz-def');
  const modeIsQuizTerm = (mode==='quiz-term');
  FLIPPED = FLIPPED && (modeIsQuizDef||modeIsQuizTerm);

  setText('term', (modeIsQuizDef && !FLIPPED) ? 'å®šç¾©: ' : card.term);
  setText('reading', card.reading||'');

  if(modeIsQuizDef && !FLIPPED){
    setHTML('def', maskDefinition(card.def));
  }else if(modeIsQuizTerm && !FLIPPED){
    setHTML('def', 'ã“ã®ç”¨èªã®å®šç¾©ã¯ï¼Ÿ');
  }else{
    setHTML('def', escapeHTML(card.def).replace(/\n/g,'<br>'));
  }

  const rels = [...(card.related||[]).map(x=>({t:x, k:'é–¢é€£'})), ...(card.antonyms||[]).map(x=>({t:x, k:'åå¯¾/æ··åŒ'}))];
  document.getElementById('rel').innerHTML = rels.map(r=>`<a href="#" data-jump="${encodeURIComponent(r.t)}">${escapeHTML(r.t)}<small class="muted">(${r.k})</small></a>`).join(' ');
}

function renderList(){
  const L = document.getElementById('list');
  L.innerHTML = VIEW.map(c=>`
    <div class="row">
      <div><b>${escapeHTML(c.term)}</b><br><small>${(c.tags||[]).map(t=>'#'+t).join(' ')}</small></div>
      <div>${escapeHTML(c.def)}</div>
    </div>
  `).join('');
}

function maskDefinition(text){
  // å®šç¾©ã®åè©ãƒ»æ•°å­—ã£ã½ã„éƒ¨åˆ†ã‚’ä¼ã›å­—ã«ï¼ˆç°¡æ˜“ï¼‰
  return escapeHTML(text).replace(/[A-Za-zÃ€-Ã–Ã˜-Ã¶Ã¸-Ã¿ä¸€-é¾¯ã-ã‚“ã‚¡-ãƒ´ãƒ¼0-9]{3,}/g, 'â–®â–®â–®');
}

function setText(id, v){ document.getElementById(id).textContent = v }
function setHTML(id, v){ document.getElementById(id).innerHTML = v }
function escapeHTML(s){ return (s||'').replace(/[&<>"]/g, m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[m])) }

// ==========================
// UI æ“ä½œ
// ==========================
function next(n=1){ IDX = (IDX + n + VIEW.length) % VIEW.length; FLIPPED=false; render(); }
function prev(){ next(-1) }

function mark(ok){
  if(!VIEW.length) return;
  const card = VIEW[IDX];
  schedule(card, ok); save();
  // æ¬¡ã«é€²ã‚€ï¼ˆæœªåˆ°é”/æœŸé™è¿‘ã„ã‚‚ã®ã‚’å„ªå…ˆï¼‰
  applyFilter();
}

// ã‚¸ãƒ£ãƒ³ãƒ—ï¼ˆé–¢é€£èªã‚¯ãƒªãƒƒã‚¯ï¼‰
addEventListener('click', e=>{
  const a = e.target.closest('a[data-jump]');
  if(!a) return;
  e.preventDefault();
  const key = decodeURIComponent(a.dataset.jump).toLowerCase();
  const i = VIEW.findIndex(x => x.term.toLowerCase()===key || (x.reading||'').toLowerCase()===key);
  if(i>=0){ IDX=i; render(); }
});

// è¿½åŠ /ç·¨é›†
let editIndex = -1; // DBä¸Šã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
function openDialog(edit=false){
  const dlg = document.getElementById('dlg');
  document.getElementById('dlg-title').textContent = edit? 'ç”¨èªã‚’ç·¨é›†' : 'ç”¨èªã‚’è¿½åŠ ';
  if(edit){
    const d = VIEW[IDX]; const j = DB.indexOf(d); editIndex = j;
    document.getElementById('f-term').value = d.term||'';
    document.getElementById('f-reading').value = d.reading||'';
    document.getElementById('f-def').value = d.def||'';
    document.getElementById('f-tags').value = (d.tags||[]).join(', ');
    document.getElementById('f-related').value = (d.related||[]).join(', ');
    document.getElementById('f-antonyms').value = (d.antonyms||[]).join(', ');
    document.getElementById('f-src').value = d.src||'';
  }else{
    editIndex = -1;
    ['f-term','f-reading','f-def','f-tags','f-related','f-antonyms','f-src'].forEach(id=>document.getElementById(id).value='');
  }
  dlg.showModal();
}

function closeDialog(){ document.getElementById('dlg').close() }

function saveDialog(){
  const d = {
    term: getVal('f-term'), reading:getVal('f-reading'), def:getVal('f-def'),
    tags: csv('f-tags'), related: csv('f-related'), antonyms: csv('f-antonyms'), src:getVal('f-src')
  };
  if(!d.term || !d.def){ alert('ç”¨èªã¨å®šç¾©ã¯å¿…é ˆã§ã™'); return }
  if(editIndex>=0){
    const prev = DB[editIndex];
    DB[editIndex] = {...prev, ...d};
  }else{
    DB.push({...d, box:0, due:Date.now(), seen:0, correct:0});
  }
  save(); closeDialog(); applyFilter();
}

function csv(id){
  return getVal(id).split(',').map(s=>s.trim()).filter(Boolean);
}
function getVal(id){ return document.getElementById(id).value.trim() }

// å‰Šé™¤
function del(){
  if(!VIEW.length) return;
  const d = VIEW[IDX]; const j = DB.indexOf(d);
  if(confirm(`ã€Œ${d.term}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)){
    DB.splice(j,1); save(); applyFilter();
  }
}

// æ›¸ãå‡ºã—/å–ã‚Šè¾¼ã¿
function exportJSON(){
  const blob = new Blob([JSON.stringify(DB,null,2)], {type:'application/json'});
  const a = Object.assign(document.createElement('a'), {href:URL.createObjectURL(blob), download:'glossary.json'});
  a.click(); setTimeout(()=>URL.revokeObjectURL(a.href), 1000);
}
function importJSON(){ document.getElementById('file').click() }

document.getElementById('file').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = () => {
    try{
      const arr = JSON.parse(reader.result);
      if(!Array.isArray(arr)) throw new Error('é…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“');
      // æ—¢å­˜ã«ãƒãƒ¼ã‚¸ï¼ˆtermã‚­ãƒ¼ã§ä¸Šæ›¸ãï¼‰
      const map = new Map(DB.map(x=>[x.term,x]));
      arr.forEach(x=>{
        if(!x.term||!x.def) return;
        const m = map.get(x.term);
        if(m){ Object.assign(m,x); }
        else { DB.push({...x, box:x.box||0, due:x.due||Date.now(), seen:x.seen||0, correct:x.correct||0}); }
      });
      save(); applyFilter(); alert('å–ã‚Šè¾¼ã¿å®Œäº†');
    }catch(err){ alert('å–ã‚Šè¾¼ã¿å¤±æ•—: '+err.message) }
  };
  reader.readAsText(f);
});

// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
addEventListener('keydown', e=>{
  const tag = e.target.tagName.toLowerCase();
  if(tag==='input' || tag==='textarea') return; // ãƒ•ã‚©ãƒ¼ãƒ ä¸­ã¯ç„¡åŠ¹
  if(e.key==='/' ){ e.preventDefault(); document.getElementById('q').focus(); return; }
  if(e.key===' ' ){ e.preventDefault(); flip(); return; }
  if(e.key==='j' ){ next(); return; }
  if(e.key==='k' ){ prev(); return; }
  if(e.key==='l' ){ mark(true); return; }
  if(e.key==='h' ){ mark(false); return; }
});

function flip(){ FLIPPED = !FLIPPED; render() }

// ã‚¤ãƒ™ãƒ³ãƒˆé…ç·š
window.addEventListener('DOMContentLoaded', () =>{
  load(); ensureSeed();
  ['q','tag','mode'].forEach(id=>document.getElementById(id).addEventListener('input', applyFilter));
  document.getElementById('btn-shuffle').addEventListener('click', shuffle);
  document.getElementById('btn-flip').addEventListener('click', flip);
  document.getElementById('btn-good').addEventListener('click', ()=>mark(true));
  document.getElementById('btn-bad').addEventListener('click', ()=>mark(false));
  document.getElementById('btn-edit').addEventListener('click', ()=>openDialog(true));
  document.getElementById('btn-add').addEventListener('click', ()=>openDialog(false));
  document.getElementById('btn-del').addEventListener('click', del);
  document.getElementById('dlg-x').addEventListener('click', closeDialog);
  document.getElementById('dlg-cancel').addEventListener('click', closeDialog);
  document.getElementById('dlg-save').addEventListener('click', saveDialog);
  document.getElementById('btn-export').addEventListener('click', exportJSON);
  document.getElementById('btn-import').addEventListener('click', importJSON);
  applyFilter();
});
</script>
</body>
</html>
